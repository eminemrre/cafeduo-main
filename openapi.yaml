openapi: 3.0.3
info:
  title: CafeDuo API
  description: |
    Gamified cafe loyalty platform API
    
    CafeDuo, kafelerde oyun oynayarak puan kazanmayÄ± ve bu puanlarla 
    Ã¶dÃ¼ller satÄ±n almayÄ± saÄŸlayan bir platformun backend API'sidir.
    
    ## Ã–zellikler
    - ğŸ® Oyun lobisi (Refleks AvÄ±, Ritim Kopyala, Ã‡ift Tek Sprint)
    - ğŸ† Liderlik tablosu
    - ğŸ Ã–dÃ¼l maÄŸazasÄ±
    - â˜• Kafe check-in sistemi
    - ğŸ“Š BaÅŸarÄ±m sistemi
    
  version: 1.0.0
  contact:
    name: CafeDuo Support
    email: support@cafeduo.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: http://localhost:3001
    description: Local development server
  - url: https://cafeduo-api.onrender.com
    description: Production server

security:
  - BearerAuth: []

tags:
  - name: Authentication
    description: KullanÄ±cÄ± kayÄ±t, giriÅŸ ve doÄŸrulama iÅŸlemleri
  - name: Users
    description: KullanÄ±cÄ± profili ve envanter yÃ¶netimi
  - name: Games
    description: Oyun lobisi ve oyun yÃ¶netimi
  - name: Shop
    description: MaÄŸaza ve Ã¶dÃ¼l iÅŸlemleri
  - name: Cafes
    description: Kafe listesi ve check-in iÅŸlemleri
  - name: Leaderboard
    description: Liderlik tablosu
  - name: Achievements
    description: BaÅŸarÄ±m sistemi
  - name: Coupons
    description: Kupon kullanÄ±mÄ± (Kafe Admin)
  - name: Admin
    description: YÃ¶netici paneli iÅŸlemleri
  - name: Health
    description: SaÄŸlÄ±k kontrolÃ¼

paths:
  # ==========================================
  # AUTHENTICATION
  # ==========================================
  /api/auth/register:
    post:
      tags:
        - Authentication
      summary: Yeni kullanÄ±cÄ± kaydÄ±
      description: E-posta doÄŸrulamasÄ± olmadan doÄŸrudan kayÄ±t oluÅŸturur
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - username
                - email
                - password
              properties:
                username:
                  type: string
                  example: "gamer123"
                email:
                  type: string
                  format: email
                  example: "user@example.com"
                password:
                  type: string
                  format: password
                  minLength: 6
                  example: "securePass123"
                department:
                  type: string
                  example: "Bilgisayar MÃ¼hendisliÄŸi"
      responses:
        200:
          description: KayÄ±t baÅŸarÄ±lÄ±
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        400:
          description: Eksik alan veya kullanÄ±mda e-posta
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        500:
          description: Sunucu hatasÄ±

  /api/auth/verify:
    post:
      tags:
        - Authentication
      summary: E-posta doÄŸrulama kodu kontrolÃ¼
      description: E-posta doÄŸrulama kodunu kontrol eder ve kullanÄ±cÄ± oluÅŸturur
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - code
              properties:
                email:
                  type: string
                  format: email
                code:
                  type: string
                  example: "123456"
      responses:
        200:
          description: DoÄŸrulama baÅŸarÄ±lÄ±
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        400:
          description: GeÃ§ersiz kod veya oturum zaman aÅŸÄ±mÄ±

  /api/auth/login:
    post:
      tags:
        - Authentication
      summary: KullanÄ±cÄ± giriÅŸi
      description: E-posta ve ÅŸifre ile giriÅŸ yapar, JWT token dÃ¶ndÃ¼rÃ¼r
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
              properties:
                email:
                  type: string
                  format: email
                  example: "user@example.com"
                password:
                  type: string
                  format: password
                  example: "securePass123"
                captchaToken:
                  type: string
                  description: Google reCAPTCHA token (opsiyonel)
      responses:
        200:
          description: GiriÅŸ baÅŸarÄ±lÄ±
          content:
            application/json:
              schema:
                type: object
                properties:
                  user:
                    $ref: '#/components/schemas/User'
                  token:
                    type: string
                    example: "eyJhbGciOiJIUzI1NiIs..."
                  bonusReceived:
                    type: boolean
                    description: GÃ¼nlÃ¼k bonus alÄ±ndÄ± mÄ±?
        401:
          description: GeÃ§ersiz e-posta veya ÅŸifre
        400:
          description: reCAPTCHA doÄŸrulamasÄ± baÅŸarÄ±sÄ±z

  /api/auth/me:
    get:
      tags:
        - Authentication
      summary: Mevcut kullanÄ±cÄ± bilgileri
      description: JWT token'dan kullanÄ±cÄ± bilgilerini getirir
      responses:
        200:
          description: KullanÄ±cÄ± bilgileri
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        401:
          description: Token eksik
        403:
          description: Token geÃ§ersiz veya sÃ¼resi dolmuÅŸ
        404:
          description: KullanÄ±cÄ± bulunamadÄ±

  /api/auth/google:
    post:
      tags:
        - Authentication
      summary: Google ile giriÅŸ
      description: Google OAuth token'Ä± ile giriÅŸ yapar
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - token
              properties:
                token:
                  type: string
                  description: Google ID token
      responses:
        200:
          description: GiriÅŸ baÅŸarÄ±lÄ±
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        401:
          description: Google doÄŸrulamasÄ± baÅŸarÄ±sÄ±z

  # ==========================================
  # USERS
  # ==========================================
  /api/users/{id}:
    put:
      tags:
        - Users
      summary: KullanÄ±cÄ± bilgilerini gÃ¼ncelle
      description: Puan, galibiyet ve oyun sayÄ±sÄ±nÄ± gÃ¼nceller
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                points:
                  type: integer
                  example: 1500
                wins:
                  type: integer
                  example: 10
                gamesPlayed:
                  type: integer
                  example: 25
                department:
                  type: string
                  example: "EndÃ¼stri MÃ¼hendisliÄŸi"
      responses:
        200:
          description: GÃ¼ncelleme baÅŸarÄ±lÄ±
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        401:
          description: Yetkilendirme hatasÄ±
        403:
          description: KaynaÄŸa eriÅŸim izni yok
        404:
          description: KullanÄ±cÄ± bulunamadÄ±

  /api/users/{id}/items:
    get:
      tags:
        - Users
      summary: KullanÄ±cÄ± kuponlarÄ±nÄ± getir
      description: Son 5 gÃ¼n iÃ§indeki aktif kuponlarÄ± listeler
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        200:
          description: Kupon listesi
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/UserItem'
        401:
          description: Yetkilendirme hatasÄ±
        403:
          description: KaynaÄŸa eriÅŸim izni yok

  /api/users/{username}/active-game:
    get:
      tags:
        - Users
      summary: KullanÄ±cÄ±nÄ±n aktif oyununu getir
      description: KullanÄ±cÄ±nÄ±n oynadÄ±ÄŸÄ± aktif bir oyun varsa dÃ¶ndÃ¼rÃ¼r
      parameters:
        - name: username
          in: path
          required: true
          schema:
            type: string
      responses:
        200:
          description: Aktif oyun veya null
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/Game'
                  - type: "null"

  # ==========================================
  # GAMES
  # ==========================================
  /api/games:
    get:
      tags:
        - Games
      summary: Bekleyen oyunlarÄ± listele
      description: Status'Ã¼ 'waiting' olan tÃ¼m oyunlarÄ± getirir
      security: []
      responses:
        200:
          description: Oyun listesi
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Game'
    
    post:
      tags:
        - Games
      summary: Yeni oyun oluÅŸtur
      description: Yeni bir oyun lobisi oluÅŸturur (host auth token iÃ§inden alÄ±nÄ±r)
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - gameType
              properties:
                gameType:
                  type: string
                  enum: ["Refleks AvÄ±", "Tank DÃ¼ellosu", "Retro SatranÃ§", "Bilgi YarÄ±ÅŸÄ±"]
                  example: "Refleks AvÄ±"
                points:
                  type: integer
                  minimum: 0
                  maximum: 5000
                  example: 150
                table:
                  type: string
                  example: "MASA04"
                chessClock:
                  type: object
                  properties:
                    baseSeconds:
                      type: integer
                      minimum: 60
                      maximum: 1800
                      example: 180
                    incrementSeconds:
                      type: integer
                      minimum: 0
                      maximum: 30
                      example: 2
      responses:
        201:
          description: Oyun oluÅŸturuldu
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Game'
        400:
          description: DoÄŸrulama hatasÄ±
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationError'
        401:
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
        500:
          description: Sunucu hatasÄ±
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'

  /api/games/{id}:
    get:
      tags:
        - Games
      summary: Oyun detaylarÄ±nÄ± getir
      description: Belirli bir oyunun detaylarÄ±nÄ± dÃ¶ndÃ¼rÃ¼r
      security: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        200:
          description: Oyun detaylarÄ±
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Game'
        404:
          description: Oyun bulunamadÄ±

  /api/games/{id}/join:
    post:
      tags:
        - Games
      summary: Oyuna katÄ±l
      description: Bir oyuna misafir olarak katÄ±lÄ±r (guest auth token iÃ§inden alÄ±nÄ±r)
      security: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        200:
          description: KatÄ±lÄ±m baÅŸarÄ±lÄ±
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
        400:
          description: DoÄŸrulama hatasÄ±
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationError'
        401:
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
        409:
          description: Oyun durum geÃ§iÅŸi geÃ§ersiz veya oyun dolu
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GameStatusTransitionError'

  /api/games/{id}/move:
    post:
      tags:
        - Games
      summary: Hamle yap
      description: Oyun iÃ§inde tek bir hamle tÃ¼rÃ¼ gÃ¶nderir (chessMove/liveSubmission/scoreSubmission/gameState/move)
      security: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                player:
                  type: string
                  enum: ["host", "guest"]
                  description: Oyuncu rolÃ¼
                move:
                  type: string
                  maxLength: 64
                  description: Legacy hamle alanÄ±
                chessMove:
                  type: object
                  required: [from, to]
                  properties:
                    from:
                      type: string
                      pattern: '^[a-h][1-8]$'
                      example: e2
                    to:
                      type: string
                      pattern: '^[a-h][1-8]$'
                      example: e4
                    promotion:
                      type: string
                      enum: [q, r, b, n]
                gameState:
                  type: object
                  description: Oyun durumu (JSON)
                scoreSubmission:
                  type: object
                  properties:
                    username:
                      type: string
                    score:
                      type: integer
                    roundsWon:
                      type: integer
                    durationMs:
                      type: integer
                    submissionKey:
                      type: string
                liveSubmission:
                  type: object
                  properties:
                    mode:
                      type: string
                    score:
                      type: integer
                    roundsWon:
                      type: integer
                    round:
                      type: integer
                    done:
                      type: boolean
                    submissionKey:
                      type: string
              oneOf:
                - required: [chessMove]
                - required: [liveSubmission]
                - required: [scoreSubmission]
                - required: [gameState]
                - required: [move]
      responses:
        200:
          description: Hamle kaydedildi
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
        400:
          description: DoÄŸrulama hatasÄ±
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationError'
        401:
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
        409:
          description: Oyun aktif olmadÄ±ÄŸÄ± iÃ§in hamle reddedildi
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GameStatusTransitionError'

  /api/games/{id}/finish:
    post:
      tags:
        - Games
      summary: Oyunu bitir
      description: Oyunu sonlandÄ±rÄ±r ve kazananÄ± belirler
      security: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                winner:
                  type: string
                  description: KazananÄ±n kullanÄ±cÄ± adÄ±
                  example: "GamerTr_99"
      responses:
        200:
          description: Oyun sonlandÄ±rÄ±ldÄ±
        409:
          description: Oyun durum geÃ§iÅŸi veya finalizasyon kuralÄ± geÃ§ersiz
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GameStatusTransitionError'

  /api/games/{id}:
    delete:
      tags:
        - Games
      summary: Oyunu sil
      description: Bir oyunu tamamen siler
      security: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        200:
          description: Oyun silindi
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean

  # ==========================================
  # SHOP
  # ==========================================
  /api/shop/buy:
    post:
      tags:
        - Shop
      summary: Ã–dÃ¼l satÄ±n al
      description: Puan kullanarak maÄŸazadan Ã¶dÃ¼l satÄ±n alÄ±r
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - item
              properties:
                item:
                  type: object
                  required:
                    - id
                    - title
                    - cost
                  properties:
                    id:
                      type: integer
                    title:
                      type: string
                    cost:
                      type: integer
                    icon:
                      type: string
      responses:
        200:
          description: SatÄ±n alma baÅŸarÄ±lÄ±
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  newPoints:
                    type: integer
                  reward:
                    $ref: '#/components/schemas/UserItem'
        400:
          description: Yetersiz puan veya geÃ§ersiz Ã¼rÃ¼n
        401:
          description: Yetkilendirme hatasÄ±

  /api/shop/inventory/{userId}:
    get:
      tags:
        - Shop
      summary: Envanteri getir
      description: KullanÄ±cÄ±nÄ±n satÄ±n aldÄ±ÄŸÄ± Ã¶dÃ¼lleri listeler
      parameters:
        - name: userId
          in: path
          required: true
          schema:
            type: integer
      responses:
        200:
          description: Envanter listesi
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/InventoryItem'
        401:
          description: Yetkilendirme hatasÄ±
        403:
          description: KaynaÄŸa eriÅŸim izni yok

  /api/rewards:
    get:
      tags:
        - Shop
      summary: TÃ¼m Ã¶dÃ¼lleri listele
      description: Aktif tÃ¼m Ã¶dÃ¼lleri getirir
      security: []
      responses:
        200:
          description: Ã–dÃ¼l listesi
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Reward'
    
    post:
      tags:
        - Shop
      summary: Yeni Ã¶dÃ¼l oluÅŸtur
      description: Yeni bir Ã¶dÃ¼l oluÅŸturur (Kafe Admin)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - title
                - cost
              properties:
                title:
                  type: string
                  example: "Bedava Filtre Kahve"
                cost:
                  type: integer
                  example: 500
                description:
                  type: string
                  example: "GÃ¼nÃ¼n yorgunluÄŸunu at."
                icon:
                  type: string
                  example: "coffee"
                cafeId:
                  type: integer
      responses:
        200:
          description: Ã–dÃ¼l oluÅŸturuldu
        400:
          description: Eksik bilgi
        501:
          description: Demo modda kullanÄ±lamaz

  /api/rewards/{id}:
    delete:
      tags:
        - Shop
      summary: Ã–dÃ¼lÃ¼ sil
      description: Bir Ã¶dÃ¼lÃ¼ pasif yapar (soft delete)
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        200:
          description: Ã–dÃ¼l silindi
        401:
          description: Yetkilendirme hatasÄ±
        403:
          description: Yetki gerekli

  # ==========================================
  # CAFES
  # ==========================================
  /api/cafes:
    get:
      tags:
        - Cafes
      summary: TÃ¼m kafeleri listele
      description: Sistemdeki tÃ¼m kafeleri getirir
      security: []
      responses:
        200:
          description: Kafe listesi
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Cafe'

  /api/cafes/{id}:
    get:
      tags:
        - Cafes
      summary: Kafe detaylarÄ±nÄ± getir
      description: Belirli bir kafenin detaylarÄ±nÄ± dÃ¶ndÃ¼rÃ¼r
      security: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        200:
          description: Kafe detaylarÄ±
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Cafe'
        404:
          description: Kafe bulunamadÄ±

  /api/cafes/checkin:
    post:
      tags:
        - Cafes
      summary: Kafeye giriÅŸ (Eski)
      description: KullanÄ±cÄ±nÄ±n kafeye giriÅŸ yapmasÄ± (userId ile)
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - userId
                - cafeId
                - tableNumber
                - pin
              properties:
                userId:
                  type: integer
                cafeId:
                  type: integer
                tableNumber:
                  type: string
                  example: "05"
                pin:
                  type: string
                  example: "1234"
      responses:
        200:
          description: GiriÅŸ baÅŸarÄ±lÄ±
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        400:
          description: Eksik bilgi veya hatalÄ± PIN
        404:
          description: Kafe veya kullanÄ±cÄ± bulunamadÄ±

  /api/cafes/check-in:
    post:
      tags:
        - Cafes
      summary: Kafeye giriÅŸ (JWT)
      description: JWT token ile kafeye gÃ¼venli giriÅŸ yapar
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - cafeId
                - tableNumber
                - pin
              properties:
                cafeId:
                  type: integer
                tableNumber:
                  type: string
                  example: "05"
                pin:
                  type: string
                  minLength: 4
                  example: "1234"
      responses:
        200:
          description: GiriÅŸ baÅŸarÄ±lÄ±
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  cafeName:
                    type: string
                  table:
                    type: string
                    example: "MASA05"
        400:
          description: YanlÄ±ÅŸ PIN veya eksik bilgi
        401:
          description: Yetkilendirme hatasÄ±
        404:
          description: Kafe bulunamadÄ±

  /api/cafes/{id}/pin:
    put:
      tags:
        - Cafes
      summary: Kafe PIN'ini gÃ¼ncelle
      description: Kafenin gÃ¼nlÃ¼k PIN kodunu gÃ¼nceller
      security: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - pin
              properties:
                pin:
                  type: string
                  minLength: 4
                  maxLength: 6
                  example: "9876"
                userId:
                  type: integer
                  description: Kafe admin'in user ID'si
      responses:
        200:
          description: PIN gÃ¼ncellendi
        400:
          description: GeÃ§ersiz PIN formatÄ±
        404:
          description: Kafe bulunamadÄ±

  # ==========================================
  # LEADERBOARD
  # ==========================================
  /api/leaderboard:
    get:
      tags:
        - Leaderboard
      summary: Liderlik tablosu
      description: En yÃ¼ksek puana sahip kullanÄ±cÄ±larÄ± listeler
      security: []
      parameters:
        - name: type
          in: query
          schema:
            type: string
            enum: ["general", "department"]
            default: "general"
        - name: department
          in: query
          schema:
            type: string
          description: BÃ¶lÃ¼m filtresi (type=department iÃ§in gerekli)
      responses:
        200:
          description: Liderlik tablosu
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/LeaderboardEntry'

  # ==========================================
  # ACHIEVEMENTS
  # ==========================================
  /api/achievements/{userId}:
    get:
      tags:
        - Achievements
      summary: KullanÄ±cÄ± baÅŸarÄ±mlarÄ±nÄ± getir
      description: TÃ¼m baÅŸarÄ±mlarÄ± ve kullanÄ±cÄ±nÄ±n kazandÄ±klarÄ±nÄ± listeler
      security: []
      parameters:
        - name: userId
          in: path
          required: true
          schema:
            type: integer
      responses:
        200:
          description: BaÅŸarÄ±m listesi
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Achievement'

  # ==========================================
  # COUPONS
  # ==========================================
  /api/coupons/use:
    post:
      tags:
        - Coupons
      summary: Kupon kullan
      description: Bir kuponu kullanÄ±lmÄ±ÅŸ olarak iÅŸaretler (Kafe Admin)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - code
              properties:
                code:
                  type: string
                  example: "CD-A1B2-C3D4"
      responses:
        200:
          description: Kupon kullanÄ±ldÄ±
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  item:
                    $ref: '#/components/schemas/UserItem'
        400:
          description: GeÃ§ersiz, sÃ¼resi dolmuÅŸ veya zaten kullanÄ±lmÄ±ÅŸ kupon

  # ==========================================
  # ADMIN
  # ==========================================
  /api/admin/users:
    get:
      tags:
        - Admin
      summary: TÃ¼m kullanÄ±cÄ±larÄ± listele
      description: Sistemdeki tÃ¼m kullanÄ±cÄ±larÄ± getirir (Admin only)
      responses:
        200:
          description: KullanÄ±cÄ± listesi
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/User'
        401:
          description: Yetkilendirme hatasÄ±
        403:
          description: Admin yetkisi gerekli

  /api/admin/games:
    get:
      tags:
        - Admin
      summary: TÃ¼m oyunlarÄ± listele
      description: Sistemdeki tÃ¼m oyunlarÄ± getirir (Admin only)
      responses:
        200:
          description: Oyun listesi
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Game'
        401:
          description: Yetkilendirme hatasÄ±
        403:
          description: Admin yetkisi gerekli

  /api/admin/users/{id}/role:
    put:
      tags:
        - Admin
      summary: KullanÄ±cÄ± rolÃ¼nÃ¼ gÃ¼ncelle
      description: KullanÄ±cÄ±nÄ±n rolÃ¼nÃ¼ deÄŸiÅŸtirir (Admin only)
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - role
              properties:
                role:
                  type: string
                  enum: ["user", "cafe_admin", "admin"]
                cafe_id:
                  type: integer
                  description: cafe_admin rolÃ¼ iÃ§in zorunlu
      responses:
        200:
          description: Rol gÃ¼ncellendi
        400:
          description: GeÃ§ersiz rol veya eksik cafe_id
        401:
          description: Yetkilendirme hatasÄ±
        403:
          description: Admin yetkisi gerekli
        404:
          description: KullanÄ±cÄ± bulunamadÄ±

  /api/admin/users/{id}:
    delete:
      tags:
        - Admin
      summary: KullanÄ±cÄ± sil
      description: Bir kullanÄ±cÄ±yÄ± tamamen siler (Admin only)
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        200:
          description: KullanÄ±cÄ± silindi
        401:
          description: Yetkilendirme hatasÄ±
        403:
          description: Admin yetkisi gerekli

  /api/admin/cafes:
    post:
      tags:
        - Admin
      summary: Yeni kafe oluÅŸtur
      description: Sistemde yeni bir kafe oluÅŸturur (Admin only)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
              properties:
                name:
                  type: string
                  example: "PAÃœ MÃ¼hendislik Kafeterya"
                address:
                  type: string
                total_tables:
                  type: integer
                  default: 20
                pin:
                  type: string
                  minLength: 4
                  maxLength: 4
                  default: "1234"
                latitude:
                  type: number
                longitude:
                  type: number
                table_count:
                  type: integer
                radius:
                  type: integer
                  description: Metre cinsinden kontrol radiusu
      responses:
        200:
          description: Kafe oluÅŸturuldu
        400:
          description: Kafe adÄ± zorunlu
        409:
          description: Bu isimde kafe zaten var
        501:
          description: Demo modda kullanÄ±lamaz

  /api/admin/cafes/{id}:
    put:
      tags:
        - Admin
      summary: Kafe gÃ¼ncelle
      description: Kafe bilgilerini gÃ¼nceller (Admin only)
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                address:
                  type: string
                total_tables:
                  type: integer
                pin:
                  type: string
                  minLength: 4
                  maxLength: 4
      responses:
        200:
          description: Kafe gÃ¼ncellendi
        400:
          description: GÃ¼ncellenecek alan bulunamadÄ± veya geÃ§ersiz PIN
        401:
          description: Yetkilendirme hatasÄ±
        403:
          description: Admin yetkisi gerekli
        404:
          description: Kafe bulunamadÄ±

  /api/admin/cafe-admins:
    post:
      tags:
        - Admin
      summary: Kafe admin'i oluÅŸtur
      description: Yeni bir kafe admin kullanÄ±cÄ±sÄ± oluÅŸturur (Admin only)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - username
                - email
                - password
                - cafeId
              properties:
                username:
                  type: string
                email:
                  type: string
                  format: email
                password:
                  type: string
                  format: password
                cafeId:
                  type: integer
      responses:
        200:
          description: Kafe admin oluÅŸturuldu
        501:
          description: Demo modda kullanÄ±lamaz

  # ==========================================
  # HEALTH
  # ==========================================
  /health:
    get:
      tags:
        - Health
      summary: SaÄŸlÄ±k kontrolÃ¼
      description: API ve veritabanÄ± baÄŸlantÄ± durumunu kontrol eder
      security: []
      responses:
        200:
          description: Sistem saÄŸlÄ±klÄ±
          content:
            application/json:
              schema:
                type: object
                properties:
                  uptime:
                    type: number
                  message:
                    type: string
                  timestamp:
                    type: integer
                  database:
                    type: boolean
        503:
          description: Servis kullanÄ±lamÄ±yor

# ==========================================
# COMPONENTS
# ==========================================
components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: |
        JWT token kullanarak yetkilendirme.
        Token'Ä± `Authorization: Bearer <token>` header'Ä±nda gÃ¶nderin.

  schemas:
    User:
      type: object
      properties:
        id:
          type: integer
          example: 1
        username:
          type: string
          example: "GamerTr_99"
        email:
          type: string
          format: email
          example: "user@example.com"
        points:
          type: integer
          example: 1250
        wins:
          type: integer
          example: 12
        gamesPlayed:
          type: integer
          example: 25
        department:
          type: string
          example: "Bilgisayar MÃ¼hendisliÄŸi"
        role:
          type: string
          enum: ["user", "cafe_admin", "admin"]
          example: "user"
        isAdmin:
          type: boolean
          example: false
        cafe_id:
          type: integer
          nullable: true
        table_number:
          type: string
          nullable: true
          example: "MASA05"
        cafe_name:
          type: string
          nullable: true
        avatar_url:
          type: string
          nullable: true
          format: uri
      required:
        - id
        - username
        - email
        - points

    Game:
      type: object
      properties:
        id:
          type: integer
          example: 1
        hostName:
          type: string
          example: "GamerTr_99"
        guestName:
          type: string
          nullable: true
          example: "Rival_Pro"
        gameType:
          type: string
          example: "Refleks AvÄ±"
        points:
          type: integer
          example: 150
        table:
          type: string
          example: "MASA04"
        status:
          type: string
          enum: ["waiting", "active", "finishing", "finished"]
          example: "waiting"
        player1Move:
          type: string
          nullable: true
        player2Move:
          type: string
          nullable: true
        gameState:
          type: object
          nullable: true
        createdAt:
          type: string
          format: date-time
        cafe_name:
          type: string
          nullable: true
      required:
        - id
        - hostName
        - gameType
        - points
        - status

    GameStatusTransitionError:
      allOf:
        - $ref: '#/components/schemas/ApiError'
        - type: object
          properties:
            code:
              type: string
              enum: ["invalid_game_status", "invalid_target_status", "invalid_status_transition"]
              example: "invalid_status_transition"
            details:
              type: object
              properties:
                fromStatus:
                  type: string
                  example: "finished"
                toStatus:
                  type: string
                  example: "active"

    Reward:
      type: object
      properties:
        id:
          type: integer
          example: 1
        title:
          type: string
          example: "Bedava Filtre Kahve"
        cost:
          type: integer
          example: 500
        description:
          type: string
          example: "GÃ¼nÃ¼n yorgunluÄŸunu at."
        icon:
          type: string
          example: "coffee"
        cafe_id:
          type: integer
          nullable: true
        is_active:
          type: boolean
          example: true
        created_at:
          type: string
          format: date-time
      required:
        - id
        - title
        - cost

    UserItem:
      type: object
      properties:
        id:
          type: integer
        user_id:
          type: integer
        item_id:
          type: integer
        item_title:
          type: string
        code:
          type: string
          example: "CD-A1B2-C3D4"
        redeemed_at:
          type: string
          format: date-time
        is_used:
          type: boolean
        used_at:
          type: string
          format: date-time
          nullable: true
        status:
          type: string
          enum: ["active", "used"]

    InventoryItem:
      type: object
      properties:
        redeemId:
          type: integer
        id:
          type: integer
        title:
          type: string
        code:
          type: string
          example: "CD-A1B2-C3D4"
        redeemedAt:
          type: string
          format: date-time
        isUsed:
          type: boolean

    Cafe:
      type: object
      properties:
        id:
          type: integer
          example: 1
        name:
          type: string
          example: "PAÃœ Ä°Ä°BF Kantin"
        address:
          type: string
          nullable: true
        total_tables:
          type: integer
          example: 30
        pin:
          type: string
          example: "1234"
        latitude:
          type: number
          nullable: true
        longitude:
          type: number
          nullable: true
        table_count:
          type: integer
        radius:
          type: integer
          description: Metre cinsinden
        daily_pin:
          type: string
          example: "1234"
      required:
        - id
        - name

    LeaderboardEntry:
      type: object
      properties:
        id:
          type: integer
        username:
          type: string
          example: "GamerTr_99"
        points:
          type: integer
          example: 2500
        wins:
          type: integer
          example: 50
        gamesPlayed:
          type: integer
          example: 100
        department:
          type: string
          example: "Bilgisayar MÃ¼hendisliÄŸi"
      required:
        - id
        - username
        - points

    Achievement:
      type: object
      properties:
        id:
          type: integer
        title:
          type: string
          example: "Ä°lk AdÄ±m"
        description:
          type: string
          example: "Ä°lk oyununu oyna."
        icon:
          type: string
          example: "footsteps"
        points_reward:
          type: integer
          example: 50
        condition_type:
          type: string
          enum: ["wins", "games_played", "points"]
        condition_value:
          type: integer
          example: 1
        unlocked:
          type: boolean
          example: true
        unlockedAt:
          type: string
          format: date-time
          nullable: true

    ApiError:
      type: object
      properties:
        code:
          type: string
          example: "TOKEN_MISSING"
        message:
          type: string
          example: "Access token required"
        details:
          nullable: true
        requestId:
          type: string
          nullable: true
          example: "1b4f4f2e-3703-47ef-a2f4-8f84efff2f0a"
        error:
          type: string
          description: message alanÄ± iÃ§in backward-compatible alias
          example: "Access token required"
      required:
        - code
        - message

    ValidationError:
      allOf:
        - $ref: '#/components/schemas/ApiError'
        - type: object
          properties:
            code:
              type: string
              enum: ["VALIDATION_ERROR"]
            details:
              type: array
              items:
                type: object
                properties:
                  path:
                    type: string
                    example: "body.points"
                  message:
                    type: string
                    example: "points 0 ile 5000 arasÄ±nda sayÄ± olmalÄ±dÄ±r."
                  value:
                    nullable: true

    Error:
      allOf:
        - $ref: '#/components/schemas/ApiError'
